<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SIGFOX | Thinger.io 中文文件</title>
    <meta name="description" content="Thinger.io 中文文件">
    <link rel="icon" href="/thinger.io-docs-zh-t/favicon.ico">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/open-iconic/1.1.1/font/css/open-iconic-bootstrap.min.css">
    
    <link rel="preload" href="/thinger.io-docs-zh-t/assets/css/0.styles.d309fa36.css" as="style"><link rel="preload" href="/thinger.io-docs-zh-t/assets/js/app.fcd5b40d.js" as="script"><link rel="preload" href="/thinger.io-docs-zh-t/assets/js/2.0b46dae4.js" as="script"><link rel="preload" href="/thinger.io-docs-zh-t/assets/js/6.944ba9a8.js" as="script"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/10.5ec0cab0.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/11.641d7dfc.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/12.45ebbda5.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/13.c77b8d0a.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/14.722b3ffb.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/15.53d10be8.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/16.3ae6833d.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/17.7a2cef2f.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/18.a1f5cc0a.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/19.4e85ac05.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/20.a36b9524.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/21.28c09250.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/22.0f63d7b7.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/23.178a1256.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/24.2c7a3301.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/25.f227074a.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/26.d391dd25.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/27.4509e994.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/3.4450e36c.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/4.d5e6607b.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/5.72a80c09.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/7.f7960ab4.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/8.56b6fd67.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/9.f199e4f8.js">
    <link rel="stylesheet" href="/thinger.io-docs-zh-t/assets/css/0.styles.d309fa36.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/thinger.io-docs-zh-t/" class="home-link router-link-active"><!----> <span class="site-name">Thinger.io 中文文件</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="https://magic-doufu.github.io/Industry-4.0-Web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  傳產工業4.0協作企劃
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://docs.thinger.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  原文文檔
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://magic-doufu.github.io/Industry-4.0-Web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  傳產工業4.0協作企劃
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://docs.thinger.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  原文文檔
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/thinger.io-docs-zh-t/" class="sidebar-link">總覽</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>裝置</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thinger.io-docs-zh-t/devices/" class="sidebar-link">裝置</a></li><li><a href="/thinger.io-docs-zh-t/devices/arduino.html" class="sidebar-link">ARDUIINO</a></li><li><a href="/thinger.io-docs-zh-t/devices/arduinoboardsexamples.html" class="sidebar-link">ARDUINO 開發板範例</a></li><li><a href="/thinger.io-docs-zh-t/devices/linux.html" class="sidebar-link">LINUX / RASPBERRY PI</a></li><li><a href="/thinger.io-docs-zh-t/devices/sigfox.html" class="active sidebar-link">SIGFOX</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/devices/sigfox.html#簡介" class="sidebar-link">簡介</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/devices/sigfox.html#將sigfox裝置與thinger-io結合" class="sidebar-link">將Sigfox裝置與Thinger.io結合</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/devices/sigfox.html#sigfox-雲端設定" class="sidebar-link">Sigfox 雲端設定</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/devices/sigfox.html#檢查-sigfox-的設定" class="sidebar-link">檢查 Sigfox 的設定</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/devices/sigfox.html#建立儀表板" class="sidebar-link">建立儀表板</a></li></ul></li><li><a href="/thinger.io-docs-zh-t/devices/http-devices.html" class="sidebar-link">HTTP 裝置</a></li></ul></section></li><li><a href="/thinger.io-docs-zh-t/coding.html" class="sidebar-link">程式設計</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>雲端控制台</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/thinger.io-docs-zh-t/api.html" class="sidebar-link">API</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>擴充元件</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/thinger.io-docs-zh-t/server-configuration.html" class="sidebar-link">伺服器管理</a></li><li><a href="/thinger.io-docs-zh-t/deployment.html" class="sidebar-link">伺服器部署</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sigfox"><a href="#sigfox" class="header-anchor">#</a> SIGFOX</h1> <p><img src="/thinger.io-docs-zh-t/assets/img/sigfox_thinger.6006f9a5.png" alt=""></p> <h2 id="簡介"><a href="#簡介" class="header-anchor">#</a> 簡介</h2> <p>Sigfox是一家成立於2009年的法國公司，其建立無線網絡以連接電表、智慧手錶和洗衣機等低功耗物體，這些物體需要不斷的發射少量數據。Sigfox採用專有技術，使用工業、科學和醫療的ISM無線頻段進行通訊，該無線頻段在歐洲使用868MHz，在美國使用902MHz。它使用超窄頻技術，可以在極低電力消耗下覆蓋大範圍區域，也因此這種網路被稱為&quot;低功率廣域網（LPWAN）&quot;。該網路基於單跳(single-hop)星型拓撲，需要ISP承載其產生的流量。該訊號還可用於輕鬆覆蓋大面積區域與位於地下的物體。</p> <p>Sigfox與LPWAN行業的許多公司合作，如德州儀器公司或Silicon Labs公司。ISM無線頻段支援雙向通訊。現有的Sigfox通訊標準<strong>每天最多支援140個上傳訊息</strong>，每個訊息可以承載<strong>12字節</strong>的payload（不包括訊息表頭和傳輸資訊）和每天最多4個下載訊息，每個訊息可以承載8個字節的 payload。如果您想了解有關Sigfox的更多詳細資訊，請造訪<a href="http://makers.sigfox.com/about/" target="_blank" rel="noopener noreferrer">Sigfox Developer Portal<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>本文件將介紹如何將SigFox裝置及其數據結合到Thinger.io平台。在第一步中，我們將回顧如何設定Thinger.io資源，然後在Sigfox方面，我們將設定與平台的通訊以推送我們的傳感器數據。</p> <h2 id="將sigfox裝置與thinger-io結合"><a href="#將sigfox裝置與thinger-io結合" class="header-anchor">#</a> 將Sigfox裝置與Thinger.io結合</h2> <p>此過程分為兩個部分，一方面，準備Thinger.io以從Sigfox接收數據，另一方面，配置Sigfox雲端回調，該回調將訊息發送回Thinger.io。在下一部分中，我們將從Thinger.io的步驟開始，對這兩個部分進行說明：</p> <p>有兩種方法可以配置Thinger.io與Sigfox裝置一起使用。最好的選擇是部署<code>Sigfox擴充元件</code>，該擴充元件將提供管理與裝置自動設定功能，上傳/下載鏈路payload處理和裝置管理等進階功能，但是此選項僅適用於已付費訂閱的開發人員。Freemium使用者還是可以按照下面的&quot;傳統結合&quot;部分來結合Sigfox裝置：</p> <h3 id="進階結合-使用sigfox擴充元件"><a href="#進階結合-使用sigfox擴充元件" class="header-anchor">#</a> <strong>進階結合 (使用Sigfox擴充元件)</strong></h3> <p><a href="/thinger.io-docs-zh-t/plugins/sigfox/"></a></p> <h3 id="傳統結合-無擴充元件"><a href="#傳統結合-無擴充元件" class="header-anchor">#</a> 傳統結合 (無擴充元件)</h3> <p>我們需要在Thinger.io帳戶中設定一些資源，例如，定義Sigfox數據的存儲位置，以及對Sigfox平台的存取以將數據存儲在我們的帳戶中。所需的步驟在以下小節中定義。</p> <h4 id="建立數據儲存桶"><a href="#建立數據儲存桶" class="header-anchor">#</a> 建立數據儲存桶</h4> <p>數據儲存桶用於儲存從Sigfox裝置接收的資訊。因此我們需要建立一個數據儲存桶來存儲我們的Sigfox裝置中的資訊。我們可以使用一個數據儲存桶存儲來自多個裝置的數據，但最好是每個裝置使用一個數據儲存桶。這樣，我們就可以透過建立儀表板，顯示來自每個裝置或感測實體的儲存桶時間序列數據。</p> <p>然後，打開雲控制台中的<code>Buckets</code>部分，並建立一個新的<code>Data Bucket</code>。我們需要填寫一些細節，例如：</p> <ol><li><code>Bucket Id</code>, 您帳戶中的唯一儲存桶ID，稍後與Sigfox結合時使用。此範例中的ID將是<code>SmartEverything</code>。保留此ID，因為它將在Sigfox端使用。</li> <li><code>Bucket Name</code>, 比ID的更加易記的標示。</li> <li><code>Bucket Description</code>, 關於儲存桶的詳細說明。</li> <li><code>Enabled</code>, 此開關用於允許儲存桶寫入，必須打開。</li> <li><code>Data Source</code>, 需要設定為<code>From Write Call</code>，因為Sigfox裝置不會直接連接到平台，而是通過REST API接口推送數據。</li></ol> <p><img src="/thinger.io-docs-zh-t/assets/img/create_sigfox_bucket.3138cd5c.png" alt=""></p> <p>填寫表格後，只需點擊<code>Add Bucket</code>即可創建存儲桶。</p> <h4 id="建立存取令牌"><a href="#建立存取令牌" class="header-anchor">#</a> 建立存取令牌</h4> <p>此時我們已經建立了一個數據儲存桶來存儲我們的Sigfox數據，與任何Thinger.io資源一樣，它們受我們的帳戶憑據保護。這樣，我們需要發出一個存取令牌，允許Sigfox後端與我們的數據儲存桶進行互動。在此範例中，我們將建立一個存取令牌，該令牌僅授予對我們的數據儲存桶的存取權限，並且只授予寫入操作權限。這樣，如果令牌以某種方式洩露，我們就不會向攻擊者公開其他資源。</p> <p>打開雲控制台中的&quot;存取令牌&quot;部分，並建立一個新的存取令牌。我們需要一些細節，例如：</p> <ol><li><code>Token Id</code>, 您帳戶中的唯一令牌標識符。</li> <li><code>Token Name</code>,  比ID的更加易記的標示。</li> <li><code>Enabled</code>, 必須打開以允許使用令牌。如果需要，可以隨時將其關閉。</li> <li><code>Token permissions</code>, 此設定為該令牌允許存取儲存桶資源的權限，<code>SmartEverything</code>在此例會使用到<code>WriteBucket</code>權限進行操作。</li></ol> <p><img src="/thinger.io-docs-zh-t/assets/img/create_sigfox_token.4a7fe065.png" alt=""></p> <p>填寫表單後，只需點擊&quot;Add Bucket&quot;即可建立令牌。此時將出現令牌值。在我們的例子中，產生的令牌如下。保留此令牌，因為它將在Sigfox端使用。</p> <div class="language- extra-class"><pre class="language-text"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJTbWFydEV2ZXJ5dGhpbmciLCJ1c3IiOiJhbHZhcm9sYiJ9.0Qb48c_ToBiIVcCOdvXU2Kn51mTnGLDcN44shVRzNls
</code></pre></div><h2 id="sigfox-雲端設定"><a href="#sigfox-雲端設定" class="header-anchor">#</a> Sigfox 雲端設定</h2> <p>此時，我們已經完成在Thinger.io數據儲存桶上接收數據所需的一切。下一步是使用我們的令牌ID和我們生成的令牌設定Sigfox後端以將數據推送給Thinger.io平台。</p> <h3 id="建立-sigfox-回調"><a href="#建立-sigfox-回調" class="header-anchor">#</a> 建立 Sigfox 回調</h3> <p>現在，我們建立一個Sigfox回調(Callback)，將訊息從我們的Sigfox裝置推送到我們的Thinger.io數據儲存桶。在我們的範例中，回調是在Sigfox裝置通過網絡發送數據時調用的端點，因此我們將設定指向數據儲存桶的回調。</p> <p>要在Sigfox中建立回調，請按照以下步驟操作：</p> <ol><li>前往 <a href="https://backend.sigfox.com" target="_blank" rel="noopener noreferrer">https://backend.sigfox.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 並登錄您的帳戶。我們假設您已經在平台上註冊了您的裝置。</li> <li>點擊<code>Device Type</code>頂部的選項卡，然後點擊要設定的裝置類型名稱。或者，您可以切換到<code>Device</code>選項卡，然後點擊裝置的<code>Device type</code>。</li> <li>於左側選單點擊<code>Callbacks</code>，然後進行新增。</li></ol> <p>在此步驟中，您需要選擇要建立<code>Custom Callback</code>的埠口，因為我們需要調用Sigfox後端不直接支援的端點。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/create_sigfox_callback.a10ee694.png" alt=""></p> <p>接著，我們需要設定回調以寫入我們的數據儲存桶。如果您想了解設定的外觀，請參考我們的截圖，你會在截圖中看到每個區域的詳細資訊。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/sigfox_callback.a820ac92.png" alt=""></p> <p>我們的範例中的設定如下：</p> <ol><li><p><code>Type</code> 為 <code>DATA</code> 與 <code>UPLINK</code>, 因為我們希望發送裝置中的數據。</p></li> <li><p><code>Channel</code> 類型是 <code>URL</code>，因為我們將調用HTTP端點。</p></li> <li><p><code>Send duplicate</code> 禁用以避免寫入不同基站收到的重複訊息。</p></li> <li><p><code>Custom payload config</code> 將完全取決於您的裝置發送的payload。在我們的例子中，我們的裝置將溫度和濕度發送為32位浮點數，因此我們將payload設定為 <code>temp::float:32:little-endian hum::float:32:little-endian</code>，其中我們將<code>temp</code>與<code>hum</code> 參數定義為小頭順序的32位浮點數。請注意，Sigfox每則訊息僅支援12字節的payload，因此您必須對此空間最佳化，例如，如果不需要達浮點數的精度，則將溫度和濕度作為整數發送。</p></li> <li><p><code>Url pattern</code> 必需根據您的Thinger.io使用者ID和我們的儲存桶名稱進行配置。</p> <ul><li>格式應該是這樣的 <code>https://api.thinger.io/v1/users/{user_id}/buckets/{bucket_id}/data</code>.</li> <li>你必須根據您的帳戶改變<code>{user_id}</code>與<code>{bucket_id}</code>。在我們的範例中，模式最終的url將是<code>https://api.thinger.io/v1/users/alvarolb/buckets/SmartEverything/data</code>.</li> <li>請注意，您還可以使用Sigfox變數來構建您的URL，即為了將來自每個裝置的數據存儲到不同的數據儲存桶，我們可以建立一個URL，如：<code>https://api.thinger.io/v1/users/alvarolb/buckets/{device}/data</code>.</li></ul></li> <li><p><code>HTTP Method</code> 應該設定為POST。</p></li> <li><p>我們必須在<code>Headers</code>中加入<code>Authorization</code>項目，其包含一個裝置令牌，以便對數據儲存桶寫入請求進行身份驗證。</p> <ul><li><p>標頭名稱應為 <code>Authorization</code></p></li> <li><p>其值應該是 <code>Bearer {access_token}</code>，且 <code>{access_token}</code> 為您在前一個章節中產生的令牌。</p></li> <li><p>在我們的例子中，我們的最終標頭值如下。注意<code>Bearer</code>和令牌之間的空格。</p> <div class="language- extra-class"><pre class="language-text"><code>Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJTbWFydEV2ZXJ5dGhpbmciLCJ1c3IiOiJhbHZhcm9sYiJ9.0Qb48c_ToBiIVcCOdvXU2Kn51mTnGLDcN44shVRzNls
</code></pre></div></li></ul></li> <li><p>最後一步是設定<code>Body</code>和它的<code>Content type</code>。對於<code>Content type</code>，我們使用<code>application/json</code>，儲存桶可以存儲任意JSON數據。然後，<code>Body</code>將包含我們要以JSON格式格式化的所有資訊。在Sigfox中，您可以根據可用變數定義您的<code>Body</code>，這些變數由平臺定義（如裝置ID，連接品質或裝置位置），或由您的payload定義。在我們的例子中，我們定義了變數<code>temp</code>與<code>hum</code>並且將其包含在一個Sigfox變數中。對於此範例，我們的payload將如下所示：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token punctuation">{</span>
    <span class="token string">&quot;device&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;{device}&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;snr&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span>snr<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;rssi&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span>rssi<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;station&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;{station}&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;latitude&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>lat<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;longitude&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>lng<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;temperature&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span>customData#temp<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;humidity&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span>customData#hum<span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>請注意，我們正在將Sigfox變數，像是<code>{device}</code>與我們在payload中的自定義數據如<code>{customData#temp}</code>混合使用。然後在每次接收訊息時處理它，並且將用即時值取代變數。因此，伺服器將接收具有裝置ID，裝置溫度，濕度，粗略位置（km精度）和訊號品質的JSON payload。</p></li></ol> <p>完成這些步驟後，我們現在完成了將數據推送到數據儲存桶的回調設定。</p> <h3 id="編寫sigfox裝置的程式"><a href="#編寫sigfox裝置的程式" class="header-anchor">#</a> 編寫Sigfox裝置的程式</h3> <p>現在是時候開始程式設計給我們的Sigfox裝置，它將把數據發送到我們的數據儲存桶。在這種情況下，我們提供了<a href="http://www.smarteverything.it/" target="_blank" rel="noopener noreferrer">SmartEverything<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://www.arduino.cc/en/Main.ArduinoBoardMKRFox1200" target="_blank" rel="noopener noreferrer">Arduino MKRFOX1200<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的範例。</p> <h4 id="arduino-mkrfox1200"><a href="#arduino-mkrfox1200" class="header-anchor">#</a> Arduino MKRFOX1200</h4> <p>Arduino MKRFOX1200旨在為尋求為項目中加入SigFox連接的製造商提供實用且經濟高效，同時具有最少網路成本的解決方案。它基於Microchip SAMD21和ATA8520 SigFox模組。可以使用典型用途的2節AA 1.5V電池執行六個月以上。該設計包括使用兩節1.5V AA或AAA電池或外部5V為電路板供電的能力。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/arduino_mkrfox1200.0c257993.jpeg" alt=""></p> <p><strong>初始化</strong></p> <p>要對此裝置進行編輯，我們將使用 <a href="https://arduino.cc" target="_blank" rel="noopener noreferrer">Arduino IDE<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。在這種情況下，有必要安裝或更新電路板工具組，可以直接從電路板管理器完成，搜尋<code>mrk</code>和選擇Arduino SAMD電路板。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/mkrfox1200_install.278696ec.png" alt=""></p> <p>您還需要安裝程式庫管理器中提供的<code>Arduino SigFox for MKRFox1200</code>程式庫，同時也<strong>必需</strong>安裝<code>Arduino Low Power</code>和<code>RTCZero</code>程式庫。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/arduino_sigfox_library.4cdcbf93.png" alt=""></p> <p>安裝成功後，我們現在可以在Arduino IDE中選擇Arduino MKRFOX12000。您還必須像任何其他Arduino板一樣選擇裝置所連接的埠口。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/arduino_mkr1200_board_selection.f9019b54.png" alt=""></p> <p>您可以通過燒錄以下範例來檢查所有內容是否已啟動並執行，該範例將提供有關模組的訊息，例如電路板ID和PAC。在Sigfox中註冊裝置需要這些資訊。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;SigFox.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">9600</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>Serial<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>SigFox<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Shield error or not present!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  String version <span class="token operator">=</span> SigFox<span class="token punctuation">.</span><span class="token function">SigVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  String ID <span class="token operator">=</span> SigFox<span class="token punctuation">.</span><span class="token function">ID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  String PAC <span class="token operator">=</span> SigFox<span class="token punctuation">.</span><span class="token function">PAC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Display module informations</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MKRFox1200 Sigfox first configuration&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;SigFox FW version &quot;</span> <span class="token operator">+</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ID  = &quot;</span> <span class="token operator">+</span> ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;PAC = &quot;</span> <span class="token operator">+</span> PAC<span class="token punctuation">)</span><span class="token punctuation">;</span>

  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Module temperature: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>SigFox<span class="token punctuation">.</span><span class="token function">internalTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Register your board on https://backend.sigfox.com/activate with provided ID and PAC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Send the module to the deepest sleep</span>
  SigFox<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// put your main code here, to run repeatedly:</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>注意</strong>：從現在開始，我們假設您已經註冊了您的Sigfox帳戶。如果還沒，請閱讀Arduino 的<a href="https://www.arduino.cc/en/Tutorial/SigFoxFirstConfiguration" target="_blank" rel="noopener noreferrer">First Configuration<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>教學。</p> <p><strong>將數據推送到Sigfox</strong></p> <p>我們已經啟動了工具鏈，可以開始寫程式來將數據推送到Sigfox後端了。在介紹程式碼之前，<strong>請記住</strong>我們在Sigfox中定義的回調中，我們建立了一個payload設定，期望接收兩個代表溫度和濕度的浮點數。因此，我們的payload必須與此定義匹配：</p> <div class="language- extra-class"><pre class="language-text"><code> temp::float:32:little-endian hum::float:32:little-endian
</code></pre></div><p>在我們的程式碼中，這個payload可以很容易地用一個<code>struct</code>包含兩個浮點數的表示。</p> <p>顯然您可以使用不同的數據類型定義自己的<code>struct</code>（但要注意結構偏移和層次），同時必須重新設定Sigfox payload以正確解碼您要發送的字段。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code> <span class="token keyword">struct</span> <span class="token class-name">data</span><span class="token punctuation">{</span>
  <span class="token keyword">float</span> temp<span class="token punctuation">;</span>
  <span class="token keyword">float</span> hum<span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>因此，程式碼最終將如下所示。我們使用Arduino MKRFOX1200和DHT傳感器，提供在Sigfox後端設定的回調所需的溫度和濕度。如果您沒有DHT傳感器，可以嘗試使用電路板的內部溫度傳感器，通過調用<code>SigFox.internalTemperature()</code>，並將濕度值設置為0或任何其他值。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code> <span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;SigFox.h&gt;</span></span>
 <span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;SimpleDHT.h&gt;</span></span>
 <span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ArduinoLowPower.h&gt;</span></span>

 <span class="token macro property">#<span class="token directive keyword">define</span> DHT11_PIN 0</span>

 <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">9600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">pinMode</span><span class="token punctuation">(</span>LED_BUILTIN<span class="token punctuation">,</span> OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">void</span> <span class="token function">blink</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> count<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> ms<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token function">digitalWrite</span><span class="token punctuation">(</span>LED_BUILTIN<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">delay</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">digitalWrite</span><span class="token punctuation">(</span>LED_BUILTIN<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>    
     <span class="token function">delay</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">void</span> <span class="token function">send_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">// initialize sigfox module</span>
   SigFox<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// Enable debug led and disable automatic deep sleep</span>
   SigFox<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// clears all pending interrupts</span>
   SigFox<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// define sigfox payload data structure</span>
   <span class="token keyword">struct</span> <span class="token class-name">data</span><span class="token punctuation">{</span>
     <span class="token keyword">float</span> temp<span class="token punctuation">;</span>
     <span class="token keyword">float</span> hum<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token comment">// read temperature and humidity from DHT sensor connected at pin DHT11_PIN</span>
   SimpleDHT11 dht11<span class="token punctuation">;</span>
   byte temp<span class="token punctuation">,</span> hum<span class="token punctuation">;</span>
   dht11<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>DHT11_PIN<span class="token punctuation">,</span> <span class="token operator">&amp;</span>temp<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hum<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// NOTE! it is not quite efficient sending bytes as floats over the net, but this is just for illustrative purposes</span>
   <span class="token keyword">struct</span> <span class="token class-name">data</span> reading<span class="token punctuation">;</span>
   reading<span class="token punctuation">.</span>temp <span class="token operator">=</span> temp<span class="token punctuation">;</span>
   reading<span class="token punctuation">.</span>hum <span class="token operator">=</span> hum<span class="token punctuation">;</span>

   <span class="token comment">// send the structure to sigfox (8 bytes)</span>
   Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Sending SigFox message!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// start a packet</span>
   SigFox<span class="token punctuation">.</span><span class="token function">beginPacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// write our buffer</span>
   SigFox<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>reading<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>reading<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// send buffer to SIGFOX network</span>
   <span class="token keyword">int</span> ret <span class="token operator">=</span> SigFox<span class="token punctuation">.</span><span class="token function">endPacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;No transmission&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 3 quick blink on error</span>
     <span class="token function">blink</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Transmission ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 1 blink on success</span>
     <span class="token function">blink</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   SigFox<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">send_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// you can deep sleep the device if you want</span>
   <span class="token comment">//LowPower.sleep(10*60*1000);</span>
 <span class="token punctuation">}</span>
</code></pre></div><p><strong>請注意</strong>，如果您想使Arduino MRKFOX1200深度睡眠，即使用電池運作時，您可以取消<code>LowPower.sleep</code>的註解，並註解<code>sleep</code>。你也可以避免使用<code>Serial</code>，以及僅有偵錯目的<code>SigFox.debug()</code>。在睡眠模式下，裝置需要手動重置才能再次燒錄。</p> <h4 id="smarteverything"><a href="#smarteverything" class="header-anchor">#</a> SmartEverything</h4> <p>SmartEverything是專為快速原型設計而設計的物聯網裝置，因為它完全相容於Arduino，可以使用多個傳感器，如MEMS壓力傳感器，接近和環境光傳感器，iNEMO 9軸慣性模組，濕度和溫度傳感器，甚至NFC NTAG，或GPS / GNSS天線。這些功能非常有趣，該主板還結合了低功耗藍牙（BLE），當然還有Sigfox模組（Telit LE51-868 S 868MHz模組）。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/sigfox_smarteverything_thinger.84f75080.jpg" alt=""></p> <p>憑藉這些出色的功能，我們可以將電路板用於多種用途，例如使用GPS進行車輛追蹤、建立微型氣象站、使用加速度計偵測震動和衝擊，以及用於其他任何地方。</p> <p>而在此例僅記錄溫度和濕度，我們建立了一個簡單的程式碼，每10分鐘就會記錄一次溫度和濕度。</p> <p><strong>初始化</strong></p> <p>要對此裝置進行程式設計，我們將使用<a href="https://arduino.cc" target="_blank" rel="noopener noreferrer">Arduino IDE<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。在這種情況下，需要安裝電路板工具鏈，可以直接從電路板管理器完成，搜尋<code>smarteverything</code>並選擇<code>Axel Elettronica</code>的Arrow Boards。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/smarteverything_install_arduino.410f94cc.png" alt=""></p> <p>安裝成功後，我們現在可以在Arduino IDE中選擇開發板。只需選擇<code>SmartEverything Fox（Native USB Port）</code>即可。您還必須像任何其他Arduino板一樣選擇裝置所連接的埠口。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/smarteverything_sigfox_board.e664b1ed.png" alt=""></p> <p><strong>將數據推送到Sigfox</strong></p> <p>現在是時候編寫一個簡單的程式來將我們的傳感器讀數發送給Sigfox。提供的範例程式將在<code>setup()</code>中基本初始化Sigfox調製解調器、傳感器和USB串列埠以進行一些偵錯。然後，在<code>loop()</code>中，我們的程式將讀取溫度和濕度，並將數據傳輸到Sigfox。它還將檢查傳輸是否成功，成功時閃爍綠色LED或否則為紅色LED。在那之後，它會睡10分鐘，正如我們在介紹中所提到的，Sigfox每天只允許140則訊息。</p> <p>在介紹程式碼之前，<strong>請記住</strong>在我們在Sigfox定義的回調中，我們建立了一個payload設定，期望接收兩個代表溫度和濕度的浮點數。因此，我們的payload必須與此定義匹配：</p> <div class="language- extra-class"><pre class="language-text"><code>temp::float:32:little-endian hum::float:32:little-endian
</code></pre></div><p>在我們的程式碼中，這個payload可以很容易地用一個<code>struct</code>包含兩個浮點數的表示。</p> <p>顯然您可以使用不同的數據類型定義自己的<code>struct</code>（但要注意結構偏移和層次），同時必須重新設定Sigfox payload以正確解碼您要發送的字段。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">struct</span> <span class="token class-name">data</span><span class="token punctuation">{</span>
 <span class="token keyword">float</span> temp<span class="token punctuation">;</span>
 <span class="token keyword">float</span> hum<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>因此，程式碼最終將如下所示。<strong>請注意</strong>，此程式碼尚未針對電池供電的情況進行最佳化。如果需要，可以對裝置啟用省電模式，但這超出了本範例的範圍。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Wire.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;SmeSFX.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Arduino.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;HTS221.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// init temp &amp; hum sensor</span>
  Wire<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  smeHumidity<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// init serial</span>
  SerialUSB<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// init sigfox module</span>
  sfxAntenna<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">19200</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>SigFox<span class="token punctuation">)</span><span class="token punctuation">;</span>
  sfxAntenna<span class="token punctuation">.</span><span class="token function">setSfxDataMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">send_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// define sigfox payload data structure</span>
  <span class="token keyword">struct</span> <span class="token class-name">data</span><span class="token punctuation">{</span>
    <span class="token keyword">float</span> temp<span class="token punctuation">;</span>
    <span class="token keyword">float</span> hum<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// read sensor data into the struct</span>
  <span class="token keyword">struct</span> <span class="token class-name">data</span> reading<span class="token punctuation">;</span>
  reading<span class="token punctuation">.</span>temp <span class="token operator">=</span> smeHumidity<span class="token punctuation">.</span><span class="token function">readHumidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  reading<span class="token punctuation">.</span>hum <span class="token operator">=</span> smeHumidity<span class="token punctuation">.</span><span class="token function">readTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// send the structure to sigfox (8 bytes)</span>
  SerialUSB<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Sending SigFox message!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sfxAntenna<span class="token punctuation">.</span><span class="token function">sfxSendData</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>reading<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>reading<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// send sigfox data</span>
  <span class="token function">send_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// wait for a response</span>
  <span class="token keyword">bool</span> response<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">do</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sfxAntenna<span class="token punctuation">.</span><span class="token function">hasSfxAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>sfxAntenna<span class="token punctuation">.</span><span class="token function">sfxDataAcknoledge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> SFX_DATA_ACK_OK<span class="token operator">:</span>
          <span class="token function">ledGreenLight</span><span class="token punctuation">(</span>HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
          SerialUSB<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Answer OK! :)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">ledGreenLight</span><span class="token punctuation">(</span>LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
          response <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> SFX_DATA_ACK_KO<span class="token operator">:</span>
          <span class="token function">ledRedLight</span><span class="token punctuation">(</span>HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
          SerialUSB<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Answer KO :(&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">ledRedLight</span><span class="token punctuation">(</span>LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
          response <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// sleep ten minutes for the next message</span>
  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="檢查-sigfox-的設定"><a href="#檢查-sigfox-的設定" class="header-anchor">#</a> 檢查 Sigfox 的設定</h2> <p>在我們同時執行裝置程式碼，設定Sigfox回調以及建立數據儲存桶之後，我們應該立即檢查所有內容是否已啟動並執行。</p> <p>我們可以從檢查Sigfox平台是否正在接收我們的訊息開始。只需切換到Sigfox平台後端，然後打開左側面板上<code>Messages</code>的部分。我們應該看到類似於以下截圖畫面的內容，其中已收到一些訊息。您還可以檢視正在發送的有效負載（十六進制）以及鏈路品質，時間戳或回調結果等其他訊息。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/sigfox_messages.bce4b55a.png" alt=""></p> <p>這裡有趣的是檢查我們的回調響應是否成功，因為回調圖示會根據結果從綠色變為紅色。在我們的例子中，我們的回調是綠色的，所以請求沒問題。您可以點擊該圖示以檢視伺服器響應，即HTTP響應200 OK 。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/sigfox_callback_response.1ce49dda.png" alt=""></p> <p>然後我們還可以檢查我們的數據儲存桶是否正在填充從Sigfox收到的數據。在Thinger.io中打開數據儲存桶應如下所示。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/sigfox_bucket_data.39967486.png" alt=""></p> <p>太好了！我們現在存儲了數據。請注意，儲存桶中的欄位是我們在Sigfox回調中設定的字段。</p> <h2 id="建立儀表板"><a href="#建立儀表板" class="header-anchor">#</a> 建立儀表板</h2> <p>現在我們已將數據存儲在儲存桶中，我們可以使用Sigfox數據建立即時儀表板。您可以建立小工具，選擇您的儲存桶作為數據源，以上就是全部！</p> <p><img src="/thinger.io-docs-zh-t/assets/img/sigfox_dashboard.eddebee7.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/thinger.io-docs-zh-t/devices/linux.html" class="prev">
          LINUX / RASPBERRY PI
        </a></span> <span class="next"><a href="/thinger.io-docs-zh-t/devices/http-devices.html">
          HTTP 裝置
        </a>
        →
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/thinger.io-docs-zh-t/assets/js/app.fcd5b40d.js" defer></script><script src="/thinger.io-docs-zh-t/assets/js/2.0b46dae4.js" defer></script><script src="/thinger.io-docs-zh-t/assets/js/6.944ba9a8.js" defer></script>
  </body>
</html>

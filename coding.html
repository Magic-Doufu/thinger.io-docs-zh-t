<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>韌體程式設計 | Thinger.io 中文文件</title>
    <meta name="description" content="Thinger.io 中文文件">
    <link rel="icon" href="/thinger.io-docs-zh-t/favicon.ico">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/open-iconic/1.1.1/font/css/open-iconic-bootstrap.min.css">
    
    <link rel="preload" href="/thinger.io-docs-zh-t/assets/css/0.styles.d309fa36.css" as="style"><link rel="preload" href="/thinger.io-docs-zh-t/assets/js/app.fcd5b40d.js" as="script"><link rel="preload" href="/thinger.io-docs-zh-t/assets/js/2.0b46dae4.js" as="script"><link rel="preload" href="/thinger.io-docs-zh-t/assets/js/20.a36b9524.js" as="script"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/10.5ec0cab0.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/11.641d7dfc.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/12.45ebbda5.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/13.c77b8d0a.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/14.722b3ffb.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/15.53d10be8.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/16.3ae6833d.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/17.7a2cef2f.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/18.a1f5cc0a.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/19.4e85ac05.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/21.28c09250.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/22.0f63d7b7.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/23.178a1256.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/24.2c7a3301.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/25.f227074a.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/26.d391dd25.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/27.4509e994.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/3.4450e36c.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/4.d5e6607b.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/5.72a80c09.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/6.944ba9a8.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/7.f7960ab4.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/8.56b6fd67.js"><link rel="prefetch" href="/thinger.io-docs-zh-t/assets/js/9.f199e4f8.js">
    <link rel="stylesheet" href="/thinger.io-docs-zh-t/assets/css/0.styles.d309fa36.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/thinger.io-docs-zh-t/" class="home-link router-link-active"><!----> <span class="site-name">Thinger.io 中文文件</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="https://magic-doufu.github.io/Industry-4.0-Web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  傳產工業4.0協作企劃
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://docs.thinger.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  原文文檔
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://magic-doufu.github.io/Industry-4.0-Web/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  傳產工業4.0協作企劃
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://docs.thinger.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  原文文檔
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/thinger.io-docs-zh-t/" class="sidebar-link">總覽</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>裝置</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/thinger.io-docs-zh-t/coding.html" class="active sidebar-link">程式設計</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#草圖概述" class="sidebar-link">草圖概述</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#設定驗證資訊" class="sidebar-link">設定驗證資訊</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#開啟偵錯輸出" class="sidebar-link">開啟偵錯輸出</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#新增資源" class="sidebar-link">新增資源</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#沒有參數的資源" class="sidebar-link">沒有參數的資源</a></li></ul></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#更易用的資源" class="sidebar-link">更易用的資源</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#裝置間的通訊" class="sidebar-link">裝置間的通訊</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#同帳戶的裝置通訊" class="sidebar-link">同帳戶的裝置通訊</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#裝置位於不同帳戶" class="sidebar-link">裝置位於不同帳戶</a></li></ul></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#使用端點" class="sidebar-link">使用端點</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#調用端點" class="sidebar-link">調用端點</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#向端點推送數據" class="sidebar-link">向端點推送數據</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#電子郵件類型的端點範例" class="sidebar-link">電子郵件類型的端點範例</a></li></ul></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#使用資料儲存桶" class="sidebar-link">使用資料儲存桶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#自裝置讀取資源-from-device-resource" class="sidebar-link">自裝置讀取資源(From Device Resource)</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#串流寫入-streaming-resource-data" class="sidebar-link">串流寫入(Streaming Resource Data)</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#調用寫入-from-write-call" class="sidebar-link">調用寫入(From Write Call)</a></li></ul></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#串流資源" class="sidebar-link">串流資源</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#esp8266-深度睡眠與-smartconfig" class="sidebar-link">ESP8266 深度睡眠與 SmartConfig</a></li><li class="sidebar-sub-header"><a href="/thinger.io-docs-zh-t/coding.html#連接故障排除指南" class="sidebar-link">連接故障排除指南</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>雲端控制台</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/thinger.io-docs-zh-t/api.html" class="sidebar-link">API</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>擴充元件</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/thinger.io-docs-zh-t/server-configuration.html" class="sidebar-link">伺服器管理</a></li><li><a href="/thinger.io-docs-zh-t/deployment.html" class="sidebar-link">伺服器部署</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="韌體程式設計"><a href="#韌體程式設計" class="header-anchor">#</a> 韌體程式設計</h1> <blockquote><p>此節內容包含如何使用Thinger.io程式庫簡單的建立適用於裝置的韌體，其中包含輸入與輸出資源、調用端點或基於WebSockets的即時串流等等。</p></blockquote> <h2 id="草圖概述"><a href="#草圖概述" class="header-anchor">#</a> 草圖概述</h2> <p>一支經典的Arduino程式結構通常長得像這樣，它具有一個<code>setup()</code>方法與一個<code>loop()</code>方法。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>setup()</code>用於初始化裝置，<code>loop()</code>則為執行階段的迴圈。
結合Thinger.io程式庫後，這些區段並不會有任何改變。
但是你需要知道需在何處定義你的裝置資源，或是在哪裡與外部服務進行互動。
一般而言，在<code>setup()</code>方法中，所有的裝置資源<code>(led、繼電器、控制接腳、伺服馬達、需要被執行的函數等</code>)都需要在此時被定義。
而當您在初始化您的裝置、設定腳位的輸入/輸出狀態或初始化串列埠的速度的同時，你也需要初始化您的資源。基本上包含設定哪些資源或值需要在網路上被公開。</p> <p>並於loop()階段不斷的調用<code>thing.handle();</code>來回應伺服器的要求。因此thinger函式庫可以處理與平台的通訊。
在此處，您可以調用端點或開啟WebSocket即時串流資訊。</p> <p>因此結構會變成如此範例所示：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// add required headers according to your device</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;SPI.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Ethernet.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ThingerEthernet.h&gt;</span></span>

<span class="token comment">// initialize Thinger instance (type can change depending on your device)</span>
ThingerEthernet <span class="token function">thing</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;deviceId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;deviceCredential&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// initialize your sensors and pins</span>

    <span class="token comment">// initialize wifi (see examples for your device)</span>

    <span class="token comment">// add resources here, like sensors, lights, etc.</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// call always the thing handle in the loop and avoid any delay here</span>
  thing<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token comment">// here you can call endpoints</span>
  <span class="token comment">// and also you can stream resources</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p>請記得，不要在<code>loop()</code>中加入任何<code>dalay()</code>，除非您知道自己在做什麼，像是在您的裝置上使用深度睡眠模式等。</p></div> <p>這當中的任何延遲都將限制裝置的正常運作，如果傳感器讀取時間較長，那麼在每個循環中讀取傳感器值或許不是好方法，這將導致裝置接收來自控制台的命令時明顯延遲。</p> <p>安裝程式庫後，您就可以輕鬆地從一些預設範例開始工作。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/LibExample.669ace5e.jpg" alt=""></p> <blockquote><p>建議您從thinger.io程式庫提供的範例開始工作。</p></blockquote> <h2 id="設定驗證資訊"><a href="#設定驗證資訊" class="header-anchor">#</a> 設定驗證資訊</h2> <p>所有連接到雲端平台的裝置都需要經過身分認證，其中包含三個部分</p> <ul><li><code>username</code></li> <li><code>deviceId</code></li> <li><code>deviceCredential</code></li></ul> <p>當您<a href="/thinger.io-docs-zh-t/console/devices-administration/#建立裝置">在控制台中建立裝置</a>時，基本上是在建立一個新的<code>Device Id</code>並設定<code>Device Credential</code>。
因此您需要在給裝置的Arduino程式中加入您所提供的同一組驗證資訊，以讓伺服端可以識別裝置並與帳戶進行關聯。此行為通常在<code>thing</code>物件被實體化時完成。</p> <p>因此，將範例中的<code>username</code>,<code>deviceId</code>和<code>deviceCredential</code>替換為您在雲端中註冊時的資訊吧：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>ThingerWifi <span class="token function">thing</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;deviceId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;deviceCredential&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="開啟偵錯輸出"><a href="#開啟偵錯輸出" class="header-anchor">#</a> 開啟偵錯輸出</h2> <p>Thinger.io程式庫提供了對其活動的廣泛記錄，這在需要解決身份驗證和Wi-Fi連接問題時尤其有用。
在草稿碼最前端（所有<code>#include</code>出現之前）定義以下內容。</p> <div class="custom-block tip"><p>在某些開發板上似乎會造成崩潰，尤其是對於程式儲存區使用接近上限的開發板。</p></div> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">define</span> _DEBUG_</span>

<span class="token comment">// the rest of your sketch goes here</span>
</code></pre></div><p>由於所有除錯訊息都通過<code>Serial</code>顯示，因此還需要啟用<code>Serial</code>。請在<code>setup()</code>中啟用它。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="新增資源"><a href="#新增資源" class="header-anchor">#</a> 新增資源</h2> <p>在 Thinger.io 平台中，每個裝置都可以定義多個資源，資源是您可以感測或觸發的任何東西。
例如溫度或濕度等傳感器值，或者打開和關閉燈的繼電器等。
你應該定義所有需要在網路上揭露的資源，且由於資源在初始化階段即被提供，因此所有資源都需要在草稿碼的<code>setup()</code>方法中定義，初始化後則可根據需求對資源進行存取。</p> <p>資源的型別共有三種，將在以下各節中進行說明。</p> <div class="el-tabs el-tabs--card el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><!----> <!----> <!----></div></div> <hr> <h3 id="沒有參數的資源"><a href="#沒有參數的資源" class="header-anchor">#</a> 沒有參數的資源</h3> <p>您也可以定義不需要任何輸入也不會產生任何輸出的資源。它們就像可以根據請求執行的回調，例如重啟裝置或執行一些特定操作。
在這種情況下，資源將沒有任何輸入或輸出參數。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>thing<span class="token punctuation">[</span><span class="token string">&quot;resource&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// write here your execution code</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="更易用的資源"><a href="#更易用的資源" class="header-anchor">#</a> 更易用的資源</h2> <p>客戶端程式庫中還包含用於更輕鬆聲明資源的語法定義，其無需考慮該資源屬於輸入或輸出。這種語法特性基於自動擴展定義成標準資源的腳本。</p> <p>使用這種定義的優點是，當您從API查詢時，您的資源將能夠處理狀態查詢。例如，如果啟用或禁用了數位引腳，則可以在API資源管理器或儀表板中檢視其目前狀態。</p> <div class="el-tabs el-tabs--card el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><p>這種資源定義用於數位引腳控制的資源，因此您可以在開啟/關閉狀態間切換，這可以用於控制LED、繼電器、電燈等。</p> <p>同時需要在<code>setup()</code>中將數位引腳定義為<code>OUTPUT</code>，否則資源將無法正常工作。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>thing<span class="token punctuation">[</span><span class="token string">&quot;relay&quot;</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token function">digitalPin</span><span class="token punctuation">(</span>PIN_NUMBER<span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">[</span><span class="token string">&quot;relay&quot;</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token function">invertedDigitalPin</span><span class="token punctuation">(</span>PIN_NUMBER<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><p>這種資源定義唯讀資源，例如從傳感器獲取的值，或者草稿碼中給定的變數。
在這個例子中，我們定義了一個用於披露傳感器讀數的資源，比如DHT11傳感器溫度。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>thing<span class="token punctuation">[</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token function">outputValue</span><span class="token punctuation">(</span>dht<span class="token punctuation">.</span><span class="token function">readTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我們也可以在程式中為任何全域變數定義輸出資源。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>thing<span class="token punctuation">[</span><span class="token string">&quot;variable&quot;</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token function">outputValue</span><span class="token punctuation">(</span>myVar<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><p>我們的草稿碼常常定義了一些在<code>loop()</code>中使用的參數或變數，如要修改這種變數可以定義這種資源。
使用這種資源，我們可以修改我們想要披露的任何參數，比如浮點數，整數，布林值等。
這種資源通常用於處理或控制行為。</p> <p>在此範例中，我們可以遠端修改被定義為全域變數的布林變數 <code>sdLogging</code></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>thing<span class="token punctuation">[</span><span class="token string">&quot;logging&quot;</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token function">inputValue</span><span class="token punctuation">(</span>sdLogging<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我們可以定義一個回調函數來知道變數何時發生了變化，因此可以透過回調函數執行其他操作。
對於此範例，資源定義的回調函數包含了其他內容，回調函數將在<code>hysteresisVar</code>被更改時執行已定義的內容。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>thing<span class="token punctuation">[</span><span class="token string">&quot;hysteresis&quot;</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token function">inputValue</span><span class="token punctuation">(</span>hysteresisVar<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// 當變數改變時做些事情</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hystereis changed to: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>hysteresisVar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><p>您也可以定義用於控制伺服馬達的資源，定義的資源將根據API互動自動處理伺服馬達的讀取或更新位置事件。</p> <p>要定義伺服資源，只需像往常一樣定義和初始化伺服馬達，然後使用以下聲明作為資源定義中的實例。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>thing<span class="token punctuation">[</span><span class="token string">&quot;servo&quot;</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token function">servo</span><span class="token punctuation">(</span>myServoInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div></div></div> <hr> <h2 id="裝置間的通訊"><a href="#裝置間的通訊" class="header-anchor">#</a> 裝置間的通訊</h2> <p>在Thinger.io中，裝置可以在彼此之間進行通訊。</p> <p>這裡有兩種狀況，一個是來自相同帳戶的裝置之間的通訊，另一個是來自不同帳戶的裝置之間的通訊。</p> <p>以下是我們對於兩種不同的方法的說明：</p> <h3 id="同帳戶的裝置通訊"><a href="#同帳戶的裝置通訊" class="header-anchor">#</a> 同帳戶的裝置通訊</h3> <p>對於此範例，裝置可以使用特定方法在相同帳戶下與其他裝置進行低延遲的簡單編碼通訊。且這個通訊中數據傳遞是可選的，意味著你也可以進行空調用。</p> <p>假設我們有兩個裝置：<code>deviceA</code>和<code>deviceB</code>。並且希望由<code>deviceB</code>建立兩者間的通訊可以傳遞到<code>deviceA</code>的特定輸入資源，我們可以如下方範例一樣使用<code>thing.call_device(,);</code>。</p> <p>在<code>deviceA</code>定義如下面的例子一樣的資源。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    thing<span class="token punctuation">[</span>“resource_On_A”<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Someone is calling me!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>而 <code>deviceB</code> 可以通過執行以下指令輕鬆調用此方法。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    thing<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 請務必以適當的頻率調用</span>
    thing<span class="token punctuation">.</span><span class="token function">call_device</span><span class="token punctuation">(</span><span class="token string">&quot;deviceA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;resource_On_A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>另一方面，如果我們希望在裝置之間共享帶有<code>pson payload</code>的訊息，則<code>deviceA</code>可以通過定義資源時加入一些預期的輸入。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    thing<span class="token punctuation">[</span>“resourceOnA”<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>pson<span class="token operator">&amp;</span> in<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> val1 <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token string">&quot;anyValue1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> val2 <span class="token operator">=</span> in<span class="token punctuation">[</span><span class="token string">&quot;anyValue2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 在此處即可使用更新完成的參數</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>deviceB</code>也可以定義一個<code>pson</code>型別變數並填充相同<code>key</code>，再透過調用方法來提供<code>resourceOnA</code>適當的輸入。如同以下程式：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    thing<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 請務必以適當的頻率調用</span>
    pson data<span class="token punctuation">;</span>
    data<span class="token punctuation">[</span><span class="token string">&quot;anyValue1&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    data<span class="token punctuation">[</span><span class="token string">&quot;anyValue2&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">43.1</span><span class="token punctuation">;</span>
    thing<span class="token punctuation">.</span><span class="token function">call_device</span><span class="token punctuation">(</span><span class="token string">&quot;deviceA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;resourceOnA&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>deviceB</code>調用此方法時可以透過提供已定義資源產生輸入資訊。在此範例，調用方式與前面的範例類似，但使用資源作為數據源。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    thing<span class="token punctuation">[</span><span class="token string">&quot;resourceName&quot;</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>pson<span class="token operator">&amp;</span> out<span class="token punctuation">)</span><span class="token punctuation">{</span>
        out<span class="token punctuation">[</span><span class="token string">&quot;anyValue1&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        out<span class="token punctuation">[</span><span class="token string">&quot;anyValue2&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">43.1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    thing<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 請務必以適當的頻率調用</span>
    thing<span class="token punctuation">.</span><span class="token function">call_device</span><span class="token punctuation">(</span><span class="token string">&quot;deviceA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;resourceOnA&quot;</span><span class="token punctuation">,</span> thing<span class="token punctuation">[</span><span class="token string">&quot;resourceName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="裝置位於不同帳戶"><a href="#裝置位於不同帳戶" class="header-anchor">#</a> 裝置位於不同帳戶</h3> <p>如果我們想要在不同帳戶的裝置間進行通訊，我們可以通過調用<code>Thinger.io Device Call</code>類型的端點來實現。只需在控制台中註冊此類型的端點，如下圖所示。</p> <p><img src="/thinger.io-docs-zh-t/assets/img/device_call.9acc8f6c.png" alt=""></p> <p>在這種情況下，需要在端點中定義幾個參數：</p> <ul><li>Endpoint Identifier: 給予裝置調用的端點ID。</li> <li>Device Owner: 裝置擁有者</li> <li>Device Identifier: 裝置在其所在帳戶下的ID</li> <li>Resource Name: 該裝置上要被調用的資源名稱</li> <li>Device Access Token: 在裝置所在帳戶下產生的裝置令牌，用於授予裝置的外部存取權。</li></ul> <p>定義後，裝置將如調用端點一樣，可以使用<code>call_endpoint</code>方法進行調用。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>thing<span class="token punctuation">.</span><span class="token function">call_endpoint</span><span class="token punctuation">(</span><span class="token string">&quot;DeviceACall&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="使用端點"><a href="#使用端點" class="header-anchor">#</a> 使用端點</h2> <p>在Thinger.io中，端點被定義為可由裝置存取的某種外部資源。借助端點功能，裝置可以輕鬆地發送電子郵件、SMS、向外部Web服務推送數據、與IFTTT互動以及使用WebHooks（調用HTTP / HTTPS URL）可以執行的任何操作。</p> <p>從Arduino草稿碼上調用端點非常簡單，因為只需要在<code>thing</code>變數上調用<code>call_endpoint</code>方法。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>thing<span class="token punctuation">.</span><span class="token function">call_endpoint</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>您可以很簡單地使用端點來進行如發送預定義的電子郵件，或者在調用端點時傳遞某些數據等操作，這在您使用需要裝置數據的第三方服務時特別有用。</p> <div class="custom-block warning"><p><strong>在調用資源時應特別注意，並以適當的速率調用它們。否則，您將很容易消耗大量傳輸流量、寄出數百封電子郵件或在第三方服務中大量消耗API​​調用次數。</strong></p></div> <h3 id="調用端點"><a href="#調用端點" class="header-anchor">#</a> 調用端點</h3> <p>這個簡單的範例將向您示範如何根據溫度來傳送高溫警報的email，對於範例我們已經先配置了一個名為<code>high_temp_email</code>的電子郵件端點，其中包含有關溫度的警告文本。</p> <p>在此範例，我們不會希望每毫秒檢查溫度，因此引入一些參數來控制感測與發送警告的頻率。此範例中將每小時檢查一次溫度，如果溫度高於30ºC，它將調用<code>high_temp_email</code>端點，該端點將向我們發送包含預定義文本的電子郵件。</p> <p>請不要在<code>loop()</code>方法中加入延遲，因為它會阻止<code>thing.handle()</code>方法執行，因此基於<code>millis()</code>函數的非阻塞延遲是個好方法。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">unsigned</span> <span class="token keyword">long</span> lastCheck <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    thing<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// thing handle是必須的</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> currentTs <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>currentTs<span class="token operator">-</span>lastCheck<span class="token operator">&gt;=</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        lastCheck <span class="token operator">=</span> currentTs<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dht<span class="token punctuation">.</span><span class="token function">readTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            thing<span class="token punctuation">.</span><span class="token function">call_endpoint</span><span class="token punctuation">(</span><span class="token string">&quot;high_temp_email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>您可以在此處發揮創造力，建立在感測器感測時可調用的端點，例如：您的濕度傳感器報告您的植物中沒有水、裝置的位置不符合預期以及其他許多狀況時可以進行的調用。 使用端點的另一種有趣方式是將其與IFTTT整合，因此您可以與多個第三方服務進行互動！</p> <h3 id="向端點推送數據"><a href="#向端點推送數據" class="header-anchor">#</a> 向端點推送數據</h3> <p>將數據採用JSON格式推送到端點也非常簡單。我們需要根據<code>pson</code>的格式加入一些資訊，然後調用<code>call_endpoint</code>方法，這些資訊將自動轉換為JSON。 例如，如果我們想要將數據報告給像 Keen.io 這樣的第三方服務，我們可以在控制台中建立這種端點。 設定完成後，我們可以在調用端點時傳遞數值，例如DHT傳感器的濕度和溫度。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// 小心傳送資料的頻率</span>
pson data<span class="token punctuation">;</span>
data<span class="token punctuation">[</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> dht<span class="token punctuation">.</span><span class="token function">readTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">[</span><span class="token string">&quot;humidity&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> dht<span class="token punctuation">.</span><span class="token function">readHumidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thing<span class="token punctuation">.</span><span class="token function">call_endpoint</span><span class="token punctuation">(</span><span class="token string">&quot;keen_endpoint&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>您還可以根據已定義的資源發送數據，即假設您有一個已經提供溫度和濕度的資源。可以重複使用此定義將相同的數據發送到端點，而無需重新定義傳感器讀數，如下例所示。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 在setup中定義用於讀取感測器數值的資源</span>
    thing<span class="token punctuation">[</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span>pson<span class="token operator">&amp;</span> out<span class="token punctuation">)</span><span class="token punctuation">{</span>
        out<span class="token punctuation">[</span><span class="token string">&quot;temperature&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> dht<span class="token punctuation">.</span><span class="token function">readTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">[</span><span class="token string">&quot;humidity&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> dht<span class="token punctuation">.</span><span class="token function">readHumidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 小心傳送資料的頻率</span>
    thing<span class="token punctuation">.</span><span class="token function">call_endpoint</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint&quot;</span><span class="token punctuation">,</span> thing<span class="token punctuation">[</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="電子郵件類型的端點範例"><a href="#電子郵件類型的端點範例" class="header-anchor">#</a> 電子郵件類型的端點範例</h3> <p>這是一個簡單的範例，應用於具有自定義內文的電子郵件類型端點：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 thing<span class="token punctuation">[</span><span class="token string">&quot;Level&quot;</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token function">outputValue</span><span class="token punctuation">(</span>actualRelative<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>actualLevel<span class="token operator">&gt;</span>UpperLevel <span class="token operator">&amp;&amp;</span> endpointUpperFlag<span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
    thing<span class="token punctuation">.</span><span class="token function">call_endpoint</span><span class="token punctuation">(</span><span class="token string">&quot;endpoint_id&quot;</span><span class="token punctuation">,</span>thing<span class="token punctuation">[</span><span class="token string">&quot;Level&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    endpointUpperFlag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>請注意，有一個變數限制此&quot;if&quot;只會執行一次，定義任何條件或方法以保證這種enpoint調用只執行一次（或以適當的頻率）是非常重要的，因為它可以造成一個微控制器通過thinger.io平台產生大量電子郵件的情況。
在端點配置中，在自定義內文電子郵件中，必須使用雙括號&quot;{{}}&quot;來調用微控制器發送的變數，在我們的範例中，我們使用了以下內文：</p> <p><code>&quot;The actual level is %&quot;</code></p> <p>並得到一封帶有文字的電子郵件：</p> <p><code>The actual level is 80.34%</code></p> <h2 id="使用資料儲存桶"><a href="#使用資料儲存桶" class="header-anchor">#</a> 使用資料儲存桶</h2> <p>Thinger.io提供一個易用且富有擴充性的虛擬儲存系統，該系統允許存儲來自裝置輸出資源的長期數據。這些資訊可於儀表板中將其可視化，也可以使用不同格式匯出數據進行其它處理或第三方資料分析。</p> <h3 id="自裝置讀取資源-from-device-resource"><a href="#自裝置讀取資源-from-device-resource" class="header-anchor">#</a> 自裝置讀取資源(From Device Resource)</h3> <p>此方式無須編寫特定方法即可使用，因為他們將透過雲端平台自動蒐集資料，僅須建立數據統並設定採樣間隔即可，如控制台<a href="/thinger.io-docs-zh-t/console/buckets.html#資料儲存桶-data-buckets">資料儲存桶</a>文件所述。</p> <h3 id="串流寫入-streaming-resource-data"><a href="#串流寫入-streaming-resource-data" class="header-anchor">#</a> 串流寫入(Streaming Resource Data)</h3> <p>此方式可讓裝置在觸發特定條件時串流資訊。我們可以在資料儲存區設定時使用**&quot;Update from device&quot;** 選項，並且使用串流資源傳送資料，如下所述：</p> <p>此例使用事先定義的輸出資源，我們稱它為 [&quot;location&quot;] ，它看起來像下面這樣：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code> <span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  thing<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 在這裡使用您自己的邏輯來確定何時進行串流/記錄資源。</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>requires_recording<span class="token punctuation">)</span><span class="token punctuation">{</span>
      thing<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token string">&quot;location&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="調用寫入-from-write-call"><a href="#調用寫入-from-write-call" class="header-anchor">#</a> 調用寫入(From Write Call)</h3> <p>此選項將允許設定資料儲存桶為不讀取任何資訊而是等待調用寫入命令的狀態，Arduino可以使用<code>write_bucket</code>方法(如此例)，而 Sigfox 也可以直接調用 REST API 來完成。此功能可以將來自不同裝置的資訊寫入至同一個儲存區中，或是儲存來自與伺服器未建立永久連接、處於睡眠狀態或諸如 Sigfox 之類的裝置所提供的資訊。</p> <p>以下是ESP8266裝置使用<code>write_bucket</code>函數將資訊寫入的範例：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 定義包含開關狀態的資源</span>
  thing<span class="token punctuation">[</span><span class="token string">&quot;door_status&quot;</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>pson <span class="token operator">&amp;</span>out<span class="token punctuation">)</span><span class="token punctuation">{</span> 
    out<span class="token punctuation">[</span><span class="token string">&quot;OPEN&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">)</span><span class="token function">digitalRead</span><span class="token punctuation">(</span>SENSOR_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token comment">// 處理連接</span>
  thing<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">digitalRead</span><span class="token punctuation">(</span>SENSOR_PIN<span class="token punctuation">)</span><span class="token operator">!=</span>previous_status<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 當門更改狀態時寫入存儲桶BucketId中</span>
    thing<span class="token punctuation">.</span><span class="token function">write_bucket</span><span class="token punctuation">(</span><span class="token string">&quot;BucketId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;door_status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  previous_status<span class="token operator">=</span><span class="token function">digitalRead</span><span class="token punctuation">(</span>SENSOR_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>請注意：此指令將搜尋PSON中的[&quot;door_status&quot;]資源，因此也可以附加自定義PSON來調用此函數，如下所示：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 處理連接</span>
  thing<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">digitalRead</span><span class="token punctuation">(</span>SENSOR_PIN<span class="token punctuation">)</span><span class="token operator">!=</span>previous_status<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 當門更改狀態時寫入存儲桶BucketId中</span>
    thing<span class="token punctuation">.</span><span class="token function">write_bucket</span><span class="token punctuation">(</span><span class="token string">&quot;BucketId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;door_status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  previous_status<span class="token operator">=</span><span class="token function">digitalRead</span><span class="token punctuation">(</span>SENSOR_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="串流資源"><a href="#串流資源" class="header-anchor">#</a> 串流資源</h2> <p>在Thinger.io中，您可以建立針對裝置的WebSockets連接，這樣您就可以即時接收傳感器值、事件或其他資訊。WebSockets主要用於控制台的儀表板功能，通常用於以可設定時間間隔傳輸資訊的資源。
定義輸出資源時，此功能可立即使用。
但是，如果您希望只在需要時才傳輸信息，例如當您的裝置檢測到移動、節能感測器偵測到目標等，您必須編寫一些程式，這與調用端點非常相似。</p> <p>在這種情況下，你必須偵測並判斷何時才進行串流，例如加速計值超過某個閾值、您的節能感測器偵測到目標或者羅盤方向正在發生變化等。</p> <p>串流資源還需要一個端點供其連接並監聽它們（即WebSocket的連接對象），因此如果沒有人監聽此數據，則不會發送數據。這由客戶端程式庫和伺服器自動處理，串流傳輸數據始終是安全的，因為裝置僅在有目的地時才傳輸信息。</p> <p>以下範例將在航向值變化超過1度時即時回報羅盤航向：</p> <p><img src="/thinger.io-docs-zh-t/assets/img/esp8266-real-time-websockets.78c82f36.gif" alt=""></p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  thing<span class="token punctuation">[</span><span class="token string">&quot;heading&quot;</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>pson<span class="token operator">&amp;</span> out<span class="token punctuation">)</span><span class="token punctuation">{</span>     
    out <span class="token operator">=</span> <span class="token function">getHeading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">float</span> previousHeading <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  thing<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">float</span> currentHeading <span class="token operator">=</span> <span class="token function">getHeading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>currentHeading<span class="token operator">-</span>previousHeading<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    thing<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>thing<span class="token punctuation">[</span><span class="token string">&quot;heading&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    previousHeading<span class="token operator">=</span>currentHeading<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="esp8266-深度睡眠與-smartconfig"><a href="#esp8266-深度睡眠與-smartconfig" class="header-anchor">#</a> ESP8266 深度睡眠與 SmartConfig</h2> <p><code>SmartConfig</code>允許使用者通過同一網路（例如智慧型手機或其他wifi客戶端）上的外部裝置設定主板的WiFi憑證。這意味著沒有敏感訊息寫入韌體或裝置上的設定文件。</p> <p><code>Deep Sleep</code>是ESP8266的一種特殊模式，它允許它關閉大部分電路並在一些可配置的時間後喚醒。 要使深度睡眠（和喚醒）正常工作，必須連接<code>GPIO16</code>（通常是開發板的<code>D0</code>）和<code>RST</code>引腳。</p> <p>但是，有些電路板選擇將內建LED連接到<code>D0</code>引腳，由於該類別在執行時使用LED作為除錯輔助工具，因此使用<code>ThingerSmartConfig</code>類別時將進入崩潰循環。</p> <p>解決方案是使用重構函數並禁止其使用LED。</p> <div class="language- extra-class"><pre class="language-text"><code>ThingerSmartConfig thing(USERNAME,
                         DEVICE_ID,
                         DEVICE_CREDENTIAL,
                         false); // 當使用深度睡眠時是必須的
</code></pre></div><h2 id="連接故障排除指南"><a href="#連接故障排除指南" class="header-anchor">#</a> 連接故障排除指南</h2> <p>在極少數的情況下，可能會導致軟體客戶端故障，妨礙與IoT平台的連接或使其變得不穩定。但是Thinger.io客戶端已經提供了一些工具來檢測和避免此類問題。
如果最近程式設計的裝置在Thinger.io伺服器上顯示為 &quot;online&quot; 甚至被鎖定，<code>_DEBUG_</code> 指令可以幫助您識別問題。 參照<a href="/thinger.io-docs-zh-t/#開啟偵錯輸出">DEBUG</a>。</p> <p>下一個列表顯示了主要問題並提供針對每個問題的解決方案</p> <div class="custom-block tip"><p>作業中...</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/thinger.io-docs-zh-t/devices/http-devices.html" class="prev">
          HTTP 裝置
        </a></span> <span class="next"><a href="/thinger.io-docs-zh-t/console/devices-administration.html">
          裝置管理
        </a>
        →
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/thinger.io-docs-zh-t/assets/js/app.fcd5b40d.js" defer></script><script src="/thinger.io-docs-zh-t/assets/js/2.0b46dae4.js" defer></script><script src="/thinger.io-docs-zh-t/assets/js/20.a36b9524.js" defer></script>
  </body>
</html>
